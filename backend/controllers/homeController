const fs = require("fs").promises;
const path = require("path");
const { getCoverPhoto, getFolderNames } = require("../helpers/helperFunctions");
const { getAllMedia } = require("../repository/mediaRepository");

exports.getmain = async (req, res) => {
	// Define the paths to the directories
	const coverDirectoryPath = "./frontend/public/assets/photos/cover/";

	try {
		const coverImageName = await getCoverPhoto(coverDirectoryPath);

		// from repository
		let mediaContents = getAllMedia();

		const mediaByYear = {};

		// structure based on year
		mediaContents.forEach((item) => {
			if (!mediaByYear[item.year]) {
				mediaByYear[item.year] = [];
			}
			mediaByYear[item.year].push(item);
		});

		res.render("index", {
			coverImageName,
			mediaByYear,
		});
	} catch (err) {
		console.error("Error:", err);
		res.status(500).send(
			"An error occurred while reading the directories."
		);
	}
};
